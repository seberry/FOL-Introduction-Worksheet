<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modal Logic Worksheet</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }

    #layout {
  display: grid;
  grid-template-columns: 260px minmax(0, 1fr);
  grid-template-rows: auto;
  height: 100vh;
    }

    aside {
      border-right: 1px solid #e5e7eb;
      background: #111827;
      color: #e5e7eb;
      padding: 1rem;
      overflow-y: auto;
    }

    aside h2 {
      margin-top: 0;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }

    .problem-button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 0.4rem 0.6rem;
      border-radius: 0.375rem;
      border: none;
      margin-bottom: 0.3rem;
      background: #1f2937;
      color: inherit;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .problem-button.active {
      background: #2563eb;
    }

    .problem-button .status {
      margin-right: 0.35rem;
    }

    main {
      padding: 1rem 1.25rem;
      overflow-y: auto;
    }

    main h1 {
      margin-top: 0;
      font-size: 1.25rem;
    }

    .constraint-list {
      font-size: 0.9rem;
      padding-left: 1.1rem;
    }

    .constraint-list li {
      margin-bottom: 0.25rem;
    }

    .check-button {
      margin-top: 0.75rem;
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: #16a34a;
      color: white;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .check-button:hover {
      background: #15803d;
    }

    #result {
      margin-top: 0.75rem;
      background: #111827;
      color: #e5e7eb;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
      white-space: pre-wrap;
    }

    #playground-panel {
        margin-top: 1.25rem;
        background: #ffffff;
        border-radius: 0.75rem;
        border: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        overflow: hidden; 
    }


    #playground-header {
        padding: 0.5rem 0.75rem;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.9rem;
        background: #f9fafb;
        }

    #playground-frame {
        border: none;
        width: 100%;
        height: 700px;
        border: none;
    }
  </style>
</head>
<body>

<div id="layout">
  <!-- Sidebar: problem list -->
  <aside>
    <h2>Problems</h2>
    <div id="problem-list"></div>
  </aside>

  <!-- Middle: active problem -->
  <main>
    <h1 id="problem-title">Modal logic worksheet</h1>
    <div id="problem-description"></div>

    <h3>Constraints to satisfy</h3>
    <ul id="constraint-list" class="constraint-list"></ul>

    <button class="check-button" onclick="checkCurrentProblem()">Check current model</button>

    <div id="result"></div>

    <!-- üëá moved inside main instead of separate column -->
    <section id="playground-panel">
      <div id="playground-header">
        Use the editor below to build a model for the active problem.
        Then click ‚ÄúCheck current model‚Äù.
      </div>
      <iframe
        id="playground-frame"
        src="modallogic/index.html"
        title="Modal Logic Playground"
      ></iframe>
      <div style="
  text-align: right;
  font-size: 0.75rem;
  color: #6b7280;
  padding: 0.35rem 0.75rem 0.45rem;
  border-top: 1px solid #e5e7eb;
">
  Model editor based on 
  <a href="https://github.com/rkirsling/modallogic" target="_blank" 
     style="color: #2563eb; text-decoration: none;">
    Ross Kirsling‚Äôs Modal Logic Playground
  </a>.
</div>
    </section>
  </main>


</div>

<script>
  // --- Problem definitions ---------------------------------------------------

  // Constraint types:
  //  { type: 'truth',   world: 0, formula: '[]p', expected: true }
  //  { type: 'truth',   world: 0, formula: '<>q', expected: false }
  //  { type: 'different', world: 0, formulaA: '[]p', formulaB: '[]q' }

  const problems = [
  // ------------------------------------------------------------
  // CW: Show satisfiable (formula true at w@ = w0)
  // ------------------------------------------------------------

  {
    id: 1,
    title: "CW1. Make (P ‚àß Q) true at w‚ÇÄ",
    description: `
Show that the sentence (P ‚àß Q) is modally satisfiable by
creating a model in which it is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "(P & Q)", expected: true }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 2,
    title: "CW2. Make (P ‚àß ¬¨‚ñ°P) true at w‚ÇÄ",
    description: `
Show modally satisfiable: P ‚àß ¬¨‚ñ°P is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "(P & ~[]P)", expected: true }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 3,
    title: "CW3. Make (‚óáP ‚àß ‚óá¬¨P) true at w‚ÇÄ",
    description: `
Show modally satisfiable: ‚óáP ‚àß ‚óá¬¨P is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "(<>P & <>~P)", expected: true }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 4,
    title: "CW4. Make (P ‚Üí Q) true at w‚ÇÄ",
    description: `
Show modally satisfiable: (P ‚Üí Q) is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "(P -> Q)", expected: true }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 5,
    title: "CW5. Make ‚ñ°(P ‚Üí Q) true at w‚ÇÄ",
    description: `
Show modally satisfiable: ‚ñ°(P ‚Üí Q) is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "[] (P -> Q)", expected: true }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 6,
    title: "CW6. Make (P ‚àß ‚óá¬¨P) true at w‚ÇÄ",
    description: `
Show modally satisfiable: (P ‚àß ‚óá¬¨P) is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "(P & <>~P)", expected: true }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 7,
    title: "CW7. Make (‚ñ°(P‚ÜíQ) ‚àß ‚ñ°(P‚Üí¬¨Q)) true at w‚ÇÄ",
    description: `
Show modally satisfiable: ‚ñ°(P‚ÜíQ) ‚àß ‚ñ°(P‚Üí¬¨Q) is true at w‚ÇÄ.`,
    constraints: [
      { type: "truth", world: 0, formula: "([](P->Q) & [](P->~Q))", expected: true }
    ],
    modelString: null,
    solved: false
  },

  // ------------------------------------------------------------
  // Participation Q: show non-equivalence (different truth values)
  // ------------------------------------------------------------

  {
    id: 8,
    title: "NE1. P vs ‚ñ°P",
    description: `
Create a model where P is true at w‚ÇÄ and ‚ñ°P is false
(or vice-versa), showing they are not equivalent.`,
    constraints: [
      { type: "different", world: 0, formulaA: "P", formulaB: "[]P" }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 9,
    title: "NE2. (P ‚àß ‚ñ°Q) vs ‚ñ°(P ‚àß Q)",
    description: `
Create a model where (P ‚àß ‚ñ°Q) and ‚ñ°(P ‚àß Q) differ in truth at w‚ÇÄ.`,
    constraints: [
      { type: "different", world: 0, formulaA: "(P & []Q)", formulaB: "[](P & Q)" }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 10,
    title: "NE3. (P‚ÜíQ) vs ‚ñ°(P‚ÜíQ)",
    description: `
Create a model where (P‚ÜíQ) and ‚ñ°(P‚ÜíQ) differ at w‚ÇÄ.`,
    constraints: [
      { type: "different", world: 0, formulaA: "(P->Q)", formulaB: "[](P->Q)" }
    ],
    modelString: null,
    solved: false
  },

  {
    id: 11,
    title: "NE4. (P‚Üí‚ñ°Q) vs ‚óá¬¨Q",
    description: `
Create a model where (P‚Üí‚ñ°Q) and ‚óá¬¨Q differ at w‚ÇÄ.`,
    constraints: [
      { type: "different", world: 0, formulaA: "(P->[]Q)", formulaB: "<>~Q" }
    ],
    modelString: null,
    solved: false
  },

  // ------------------------------------------------------------
  // Participation Q: falsify principles
  // ------------------------------------------------------------

  {
    id: 12,
    title: "PR1. Falsify ‚ñ°œÜ ‚Üí ‚ñ°‚ñ°œÜ at w‚ÇÄ",
    description: `
Create a Kripke model where ‚ñ°œÜ ‚Üí ‚ñ°‚ñ°œÜ is false at w‚ÇÄ.  
(i.e. ‚ñ°œÜ is true at w‚ÇÄ but ‚ñ°‚ñ°œÜ is false at w‚ÇÄ.)`,
    constraints: [
      { type: "truth", world: 0, formula: "( []P -> [][]P )", expected: false }
      // You can replace P with any variable ‚Äî MPL doesn't care.
    ],
    modelString: null,
    solved: false
  },

  {
    id: 13,
    title: "PR2. Falsify ‚óá‚ñ°œÜ ‚Üí ‚ñ°œÜ at w‚ÇÄ",
    description: `
Create a Kripke model where ‚óá‚ñ°œÜ ‚Üí ‚ñ°œÜ is false at w‚ÇÄ.  
(i.e. ‚óá‚ñ°œÜ holds at w‚ÇÄ but ‚ñ°œÜ does not.)`,
    constraints: [
      { type: "truth", world: 0, formula: "( <>[]P -> []P )", expected: false }
    ],
    modelString: null,
    solved: false
  }
];

  let activeIndex = 0;

  // --- Helper: render problem list ------------------------------------------

  function renderProblemList() {
    const list = document.getElementById("problem-list");
    list.innerHTML = "";
    problems.forEach((p, idx) => {
      const btn = document.createElement("button");
      btn.className = "problem-button" + (idx === activeIndex ? " active" : "");
      const status = p.solved ? "‚úÖ" : "‚¨ú";
      btn.innerHTML = `<span class="status">${status}</span>${p.title}`;
      btn.onclick = () => setActiveProblem(idx);
      list.appendChild(btn);
    });
  }

  // --- Helper: render active problem ----------------------------------------

  function setActiveProblem(index) {
    activeIndex = index;
    renderProblemList();

    const p = problems[activeIndex];

    document.getElementById("problem-title").textContent = p.title;
    document.getElementById("problem-description").textContent = p.description.trim();

    const ul = document.getElementById("constraint-list");
    ul.innerHTML = "";
    for (const c of p.constraints) {
      const li = document.createElement("li");
      if (c.type === "truth") {
        li.textContent = `At w0: ${c.formula} should be ${c.expected ? "true" : "false"}.`;
      } else if (c.type === "different") {
        li.textContent = `At w0: ${c.formulaA} and ${c.formulaB} must have different truth values.`;
      }
      ul.appendChild(li);
    }

    document.getElementById("result").textContent = "";

    // Load model into iframe: either the stored one or the default
    const frame = document.getElementById("playground-frame");
    let url = "modallogic/index.html";
    if (p.modelString) {
      url += "?model=" + encodeURIComponent(p.modelString);
    }
    frame.src = url;
  }

  // --- Forall x style pretty-print ------------------------------------------

  function formatModelForForallX(model) {
    const states = model.getStates();
    const worldIndices = [];
    for (let i = 0; i < states.length; i++) {
      if (states[i] !== null && states[i] !== undefined) {
        worldIndices.push(i);
      }
    }

    // Worlds: W: 1,2,...
    const W = "W: " + (worldIndices.length ? worldIndices.map(i => i + 1).join(", ") : "‚Äî");

    // Accessibility relation R
    const pairs = [];
    for (const i of worldIndices) {
      const succ = model.getSuccessorsOf(i);
      for (const j of succ) {
        if (worldIndices.includes(j)) {
          pairs.push(`‚ü®${i + 1},${j + 1}‚ü©`);
        }
      }
    }
    const R = "R: " + (pairs.length ? pairs.join(", ") : "‚Äî");

    // Valuation ŒΩ
    const varsSet = new Set();
    for (const st of states) {
      if (st) {
        for (const v in st) varsSet.add(v);
      }
    }
    const vars = Array.from(varsSet).sort();
    const nuParts = [];
    for (const i of worldIndices) {
      const st = states[i] || {};
      for (const v of vars) {
        const val = !!st[v];
        nuParts.push(`ŒΩ${i + 1}(${v}) = ${val ? "T" : "F"}`);
      }
    }
    const nu = "ŒΩ: " + (nuParts.length ? nuParts.join(", ") : "‚Äî");

    return `${W}\n${R}\n${nu}`;
  }

  // --- Core: check current model against constraints ------------------------

  function checkCurrentProblem() {
    const frame = document.getElementById("playground-frame");
    const win = frame.contentWindow;

    if (!win || !win.MPL || !win.model) {
      alert("Playground not ready yet ‚Äî try again in a moment.");
      return;
    }

    const p = problems[activeIndex];
    const model = win.model;
    const MPL = win.MPL;

    // Persist model so when we switch away and back, we reload it
    p.modelString = model.getModelString();

    let allOk = true;
    const lines = [];

    for (const c of p.constraints) {
      if (c.type === "truth") {
        const wff = new MPL.Wff(c.formula);
        const val = MPL.truth(model, c.world, wff);
        const ok = (val === c.expected);
        allOk = allOk && ok;
        lines.push(
          `At w${c.world + 1}: ${c.formula} is ${val ? "T" : "F"} (expected ${c.expected ? "T" : "F"})`
        );
      } else if (c.type === "different") {
        const fA = new MPL.Wff(c.formulaA);
        const fB = new MPL.Wff(c.formulaB);
        const valA = MPL.truth(model, c.world, fA);
        const valB = MPL.truth(model, c.world, fB);
        const ok = (valA !== valB);
        allOk = allOk && ok;
        lines.push(
          `At w${c.world }: ${c.formulaA} = ${valA ? "T" : "F"}, ` +
          `${c.formulaB} = ${valB ? "T" : "F"} (need them to differ)`
        );
      }
    }

    p.solved = allOk;
    renderProblemList();

    let out = lines.join("\n") + "\n\n";
    if (allOk) {
      out += "‚úÖ Solved!\n\nModel in Forall x style:\n";
      out += formatModelForForallX(model);
    } else {
      out += "‚ùå Not yet ‚Äî adjust your model and try again.";
    }

    document.getElementById("result").textContent = out;
  }

  // --- Init ------------------------------------------------------------------

  window.addEventListener("load", () => {
    renderProblemList();
    setActiveProblem(0);
  });
</script>

<script>
function resizePlayground() {
  const iframe = document.getElementById('playground-frame');
  if (!iframe) return;
  try {
    const innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    iframe.style.height = innerDoc.body.scrollHeight + "px";
  } catch (e) {
    // silently fail if cross-origin (should not happen here)
  }
}

// Resize once when iframe loads
document.getElementById('playground-frame').addEventListener('load', resizePlayground);
</script>

</body>



</html>
